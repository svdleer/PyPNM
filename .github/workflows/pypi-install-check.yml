name: PyPI Install Check

on:
  schedule:
    - cron: "30 8 * * *"     # Every day at 08:30 UTC (offset from Daily Build)
  workflow_dispatch:          # Allow manual triggering from GitHub UI

jobs:
  pypi-install-check:
    name: PyPI Install - Python ${{ matrix.python-version }}
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.10", "3.11", "3.12", "3.13"]

    steps:
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: Upgrade pip
        run: |
          python -m pip install --upgrade pip

      - name: Install latest pypnm-docsis from PyPI
        run: |
          echo "Installing latest pypnm-docsis from PyPI..."
          python -m pip install pypnm-docsis

      - name: Smoke test import and version
        run: |
          python - << 'EOF'
          import pypnm
          from pypnm import __version__
          import inspect

          print("PyPNM version (from PyPI):", __version__)
          print("PyPNM module file:", inspect.getfile(pypnm))
          EOF

      - name: Smoke test CLI entrypoint
        run: |
          pypnm --help
